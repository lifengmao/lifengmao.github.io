---
title: HTTP基础
date:  2017-11-28 20:30:00
categories:
- 通信/HTTP
tags: HTTP方法 HTTP状态码 持久连接 管线化
---

HTTP协议(超文本传输协议)是Web通信的基础。我们在编写页面时，页面也需要跟服务器进行通信。因此，学习一些基础的HTTP知识是非常必要的。本文主要介绍以下几个关于HTTP协议的基础知识：
* HTTP协议的主要特点
* HTTP协议的报文
* HTTP方法
* HTTP状态码
* HTTP持久连接和管线化

### HTTP的主要特点

HTTP协议的主要特点可以概括为以下几点：
1.支持客户端/服务器模式。其中发出HTTP请求的就是客户端，接收请求发出响应的就是服务器。
2.简单快速。HTTP协议非常简单，是的HTTP服务器的程序规模小，因而通信速度很快。客户端向服务器请求服务时，只需要传送请求方法和路径。
3.灵活。HTTP允许传输任意类型的数据对象。
4.无连接。HTTP限制每个连接只处理一个请求，服务器完成客户的请求并收到客户端的应答后就会断开连接。
5.无状态。HTTP协议是无状态协议。即协议对事务处理没有记忆能力。

### HTTP协议报文

在HTTP协议中，客户端和服务器的交互是通过报文实现的。请求端的HTTP报文就是请求报文，响应端的就叫做响应报文。
报文本身大致可分为报文首部和报文主体两块。两者由最初出现的空行来划分。
请求报文和响应报文的首部内容主要由以下数据组成：
* 请求行（请求报文）：包含用于请求的方法，请求URI和HTTP版本
* 状态行（响应报文）：包含表明响应结果的状态码，原因短语和HTTP版本
* 首部字段：包含表示请求和响应的各种条件和属性的各类首部。一般有4种首部：通用首部、请求首部、响应首部和实体首部
* 其他：可能包含HTTP的RFC未定义的首部（比如说Cookie等）

其中，请求报文是由请求行、请求首部字段、内容实体组成，相应的，相应报文是由状态行、响应首部字段、实体主体组成。
HTTP首部字段是由首部字段名和字段值构成的，中间用冒号“：”分隔。
下面介绍首部字段里的4种首部。

#### 通用首部

通用首部是请求报文和响应报文两方都会使用的首部。一般常用的通用首部字段有：

* Cache-Control:该字段可以操作缓存的工作机制
* Connection:该字段具有两个作用：首先是控制代理不再转发的首部字段，其次是管理持久连接。
* Date:表明创建HTTP报文的日期和时间
* Pragma:该字段是HTTP/1.1之前版本的历史遗留字段，作为与HTTP/1.0的向后兼容而定义
* Trailer:首部字段 Trailer 会事先说明在报文主体后记录了哪些首部字段。
* Transfer-Encoding:首部字段 Transfer-Encoding 规定了传输报文主体时采用的编码方式。
* Upgrade:首部字段 Upgrade 用于检测 HTTP 协议及其他协议是否可使用更高的版本进行通信，其参数值可以用来指定一个完全不同的通信协议。
* Via:使用首部字段 Via 是为了追踪客户端与服务器之间的请求和响应报文的传输路径。
* Warning:该首部通常会告知用户一些与缓存相关的问题的警告。

### 请求首部

请求首部字段是从客户端往服务器端发送请求报文中所使用的字段，用于补充请求的附加信息、客户端信息、对响应内容相关的优先级等内容。一般常用的请求首部有：

* Accept:Accept 首部字段可通知服务器，用户代理能够处理的媒体类型及媒体类型的相对优先级。可使用 type/subtype 这种形式，一次指定多种媒体类型。
* Accept-Charset:Accept-Charset 首部字段可用来通知服务器用户代理支持的字符集及字符集的相对优先顺序。另外，可一次性指定多种字符集。
* Accept-Encoding:Accept-Encoding 首部字段用来告知服务器用户代理支持的内容编码及内容编码的优先级顺序。
* Accept-Language:首部字段 Accept-Language 用来告知服务器用户代理能够处理的自然语言集（指中文或英文等），以及自然语言集的相对优先级。可一次指定多种自然语言集。
* Authorization:首部字段 Authorization 是用来告知服务器，用户代理的认证信息（证书值）。
* Expect:客户端使用首部字段 Expect 来告知服务器，期望出现的某种特定行为。因服务器无法理解客户端的期望作出回应而发生错误时，会返回状态码 417 Expectation Failed。
* From:首部字段 From 用来告知服务器使用用户代理的用户的电子邮件地址。
* Host:首部字段 Host 会告知服务器，请求的资源所处的互联网主机名和端口号。
* If-xxx :形如 If-xxx 这种样式的请求首部字段，都可称为条件请求。服务器接收到附带条件的请求后，只有判断指定条件为真时，才会执行请求。
* Proxy-Authorization:接收到从代理服务器发来的认证质询时，客户端会发送包含首部字段 Proxy-Authorization 的请求，以告知服务器认证所需要的信息。
* Range:对于只需获取部分资源的范围请求，包含首部字段 Range 即可告知服务器资源的指定范围。
* Referer:首部字段 Referer 会告知服务器请求的原始资源的 URI。
* TE:首部字段 TE 会告知服务器客户端能够处理响应的传输编码方式及相对优先级。
* User-Agent:首部字段 User-Agent 会将创建请求的浏览器和用户代理名称等信息传达给服务器。

#### 响应首部字段

响应首部字段是由服务器端向客户端返回响应报文中所使用的字段，用于补充响应的附加信息、服务器信息，以及对客户端的附加要求等信息。常用的响应首部字段有：

* Accept-Ranges:首部字段 Accept-Ranges 是用来告知客户端服务器是否能处理范围请求，以指定获取服务器端某个部分的资源。
* Age:首部字段 Age 能告知客户端，源服务器在多久前创建了响应。字段值的单位为秒。
* ETag:首部字段 ETag 能告知客户端实体标识。它是一种可将资源以字符串形式做唯一性标识的方式。服务器会为每份资源分配对应的 ETag 值。
* Location:使用首部字段 Location 可以将响应接收方引导至某个与请求 URI 位置不同的资源。
* Proxy-Authenticate:首部字段 Proxy-Authenticate 会把由代理服务器所要求的认证信息发送给客户端。
* Retry-After:首部字段 Retry-After 告知客户端应该在多久之后再次发送请求。主要配合状态码 503 Service Unavailable 响应，或 3xx Redirect 响应一起使用。
* Server:首部字段 Server 告知客户端当前服务器上安装的 HTTP 服务器应用程序的信息。
* Vary:首部字段 Vary 可对缓存进行控制。源服务器会向代理服务器传达关于本地缓存使用方法的命令。
* WWW-Authenticate:首部字段 WWW-Authenticate 用于 HTTP 访问认证。

#### 实体首部字段

实体首部字段是包含在请求报文和响应报文中的实体部分所使用的首部，用于补充内容的更新时间等与实体相关的信息。

* Allow:首部字段 Allow 用于通知客户端能够支持 Request-URI 指定资源的所有 HTTP 方法。
* Content-Encoding:首部字段 Content-Encoding 会告知客户端服务器对实体的主体部分选用的内容编码方式。
* Content-Language:首部字段 Content-Language 会告知客户端，实体主体使用的自然语言（指中文或英文等语言）。
* Content-Length:首部字段 Content-Length 表明了实体主体部分的大小（单位是字节）。
* Content-Location:首部字段 Content-Location 给出与报文主体部分相对应的 URI。
* Content-MD5:首部字段 Content-MD5 是一串由 MD5 算法生成的值，其目的在于检查报文主体在传输过程中是否保持完整，以及确认传输到达。
* Content-Range:针对范围请求，返回响应时使用的首部字段 Content-Range，能告知客户端作为响应返回的实体的哪个部分符合范围请求。
* Content-Type:首部字段 Content-Type 说明了实体主体内对象的媒体类型。
* Expires:首部字段 Expires 会将资源失效的日期告知客户端。
* Last-Modified:首部字段 Last-Modified 指明资源最终修改的时间。

#### 其他首部字段

管理服务器与客户端之间状态的 Cookie，虽然没有被编入标准化 HTTP/1.1 的 RFC2616 中，但在 Web 网站方面得到了广泛的应用。

Cookie 的工作机制是用户识别及状态管理。Web 网站为了管理用户的状态会通过 Web 浏览器，把一些数据临时写入用户的计算机内。接着当用户访问该Web网站时，可通过通信方式取回之前存放的 Cookie。

调用 Cookie 时，由于可校验 Cookie 的有效期，以及发送方的域、路径、协议等信息，所以正规发布的 Cookie 内的数据不会因来自其他 Web 站点和攻击者的攻击而泄露。
与Cookie有关的首部字段有两个：
* Set-Cookie:开始状态管理所使用的Cookie信息
* Cookie:服务器接收到的Cookie信息

其他还有各种服务器和浏览器自行扩展的首部字段：

* X-Frame-Options:用于控制网站内容在其他 Web 网站的 Frame 标签内的显示问题。其主要目的是为了防止点击劫持（clickjacking）攻击。
* X-XSS-Protection:首部字段 X-XSS-Protection 属于 HTTP 响应首部，它是针对跨站脚本攻击（XSS）的一种对策，用于控制浏览器 XSS 防护机制的开关。
* DNT:首部字段 DNT 属于 HTTP 请求首部，其中 DNT 是 Do Not Track 的简称，意为拒绝个人信息被收集，是表示拒绝被精准广告追踪的一种方法。
* P3P:首部字段 P3P 属于 HTTP 响应首部，通过利用 P3P（The Platform for Privacy Preferences，在线隐私偏好平台）技术，可以让 Web 网站上的个人隐私变成一种仅供程序可理解的形式，以达到保护用户隐私的目的。

### HTTP方法

HTTP方法可以指定请求的资源按照期望产生某种行为。目前规定的方法有以下几种：

* GET ：获取资源。GET 方法用来请求访问已被 URI 识别的资源。指定的资源经服务器端解析后返回响应内容。也就是说，如果请求的资源是文本，那就保持原样返回；如果是像 CGI（Common Gateway Interface，通用网关接口）那样的程序，则返回经过执行后的输出结果。
* POST：传输实体主体。虽然用 GET 方法也可以传输实体的主体，但一般不用 GET 方法进行传输，而是用 POST 方法。虽说 POST 的功能与 GET 很相似，但 POST 的主要目的并不是获取响应的主体内容。
* PUT：传输文件。PUT 方法用来传输文件，但是，鉴于 HTTP/1.1 的 PUT 方法自身不带验证机制，任何人都可以上传文件 , 存在安全性问题，因此一般的 Web 网站不使用该方法。
* HEAD：获得报文首部。HEAD 方法和 GET 方法一样，只是不返回报文主体部分。用于确认 URI 的有效性及资源更新的日期时间等。
* DELETE：删除文件。DELETE 方法用来删除文件，但是，HTTP/1.1 的 DELETE 方法本身和 PUT 方法一样不带验证机制，所以一般的 Web 网站也不使用 DELETE 方法。
* OPTIONS：询问支持的方法。OPTIONS 方法用来查询针对请求 URI 指定的资源支持的方法。
* TRACE：追踪路径。TRACE 方法是让 Web 服务器端将之前的请求通信返回给客户端的方法。
* CONNECT：要求用隧道协议连接代理。

虽然规定的方法有以上几种，但是实际应用中比较常用的只有GET、POST和HEAD方法，因此，主要掌握这三种方法即可。

### HTTP状态码

HTTP状态码负责表示客户端HTTP请求的返回结果，标记服务器端的处理是否正常、通知出现的错误等工作。

#### 1XX

以1开头的状态码是信息性状态码，表示接收的请求正在处理中。

#### 2XX

以2开头的状态码是成功状态码，表示请求正常处理完毕。
常用的成功状态码有：
* 200 OK 
* 204 No Content
* 206 Partial Content

#### 3XX

3XX状态码是重定向状态码，表示需要附加操作以完成请求。
常用的重定向状态码有：
* 301 Moved Permanently
* 302 Found
* 303 See Other
* 304 Not Modified
* 307 Temporary Redirect

#### 4XX

4XX是客户端错误状态码，表示客户端出现错误，服务器无法处理请求。
常用的客户端错误码有：

* 400 Bad Request
* 401 Unauthorization
* 403 Forbidden
* 404 Not Found

#### 5XX

5XX是服务器错误状态码，表示服务器出现问题，处理请求出错。
常用的服务器错误码有：

* 500 Internet Server Error
* 503 Service Unavailable

### 持久连接和管线化

HTTP 协议的初始版本中，每进行一次 HTTP 通信就要断开一次 TCP 连接。
以当年的通信情况来说，因为都是些容量很小的文本传输，所以即使这样也没有多大问题。可随着 HTTP 的普及，文档中包含大量图片的情况多了起来。

比如，使用浏览器浏览一个包含多张图片的 HTML 页面时，在发送请求访问 HTML 页面资源的同时，也会请求该 HTML 页面里包含的其他资源。因此，每次的请求都会造成无谓的 TCP 连接建立和断开，增加通信量的开销。

#### 持久连接

为解决上述 TCP 连接的问题，HTTP/1.1 和一部分的 HTTP/1.0 想出了持久连接（HTTP Persistent Connections，也称为 HTTP keep-alive 或 HTTP connection reuse）的方法。持久连接的特点是，只要任意一端没有明确提出断开连接，则保持 TCP 连接状态。
持久连接的好处在于减少了 TCP 连接的重复建立和断开所造成的额外开销，减轻了服务器端的负载。另外，减少开销的那部分时间，使 HTTP 请求和响应能够更早地结束，这样 Web 页面的显示速度也就相应提高了。
在 HTTP/1.1 中，所有的连接默认都是持久连接，但在 HTTP/1.0 内并未标准化。虽然有一部分服务器通过非标准的手段实现了持久连接，但服务器端不一定能够支持持久连接。毫无疑问，除了服务器端，客户端也需要支持持久连接。

#### 管线化

持久连接使得多数请求以管线化（pipelining）方式发送成为可能。从前发送请求后需等待并收到响应，才能发送下一个请求。管线化技术出现后，不用等待响应亦可直接发送下一个请求。

这样就能够做到同时并行发送多个请求，而不需要一个接一个地等待响应了。

比如，当请求一个包含 10 张图片的 HTML Web 页面，与挨个连接相比，用持久连接可以让请求更快结束。而管线化技术则比持久连接还要快。请求数越多，时间差就越明显。

### 小结

本文介绍了一些HTTP协议，包括HTTP的报文的组成、HTTP的方法、HTTP的状态码以及持久连接和管线化的基本概念。

### 参考资料

[《图解HTTP》](http://www.ituring.com.cn/book/1229)







